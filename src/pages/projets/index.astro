---
import BaseLayout from '../../layouts/BaseLayout.astro';
import ProjectGrid from '../../components/ProjectGrid.astro';
import { getCollection } from 'astro:content';
import { getGitHubProjectsWithStatus, mergeProjects } from '../../utils/projects';

// Fetch both markdown and GitHub projets
const markdownProjets = await getCollection('projets');
const githubResult = await getGitHubProjectsWithStatus();

// Merge and sort all projets by date
const allProjets = mergeProjects(
  markdownProjets.map(p => ({
    slug: p.slug,
    data: { ...p.data, source: 'markdown' as const },
  })),
  githubResult.projects
);

// Track if we had any GitHub fetch errors
const hasGitHubErrors = githubResult.hasErrors;
---

<BaseLayout
  title="Projets"
  description="Browse my portfolio of web development projets showcasing creativity and technical skill."
>
  <section class="section projets-page">
    <div class="container">
      <div class="page-header">
        <h1 class="page-title">
          My <span class="gradient-text">Projets</span>
        </h1>
        <p class="page-description">
          A collection of my work, ranging from personal experiments to full-featured applications.
          Each projet represents a unique challenge and creative solution.
        </p>
      </div>

      {hasGitHubErrors && allProjets.length === 0 && (
        <div class="error-banner">
          <p>Unable to load projets from GitHub. Please try refreshing the page.</p>
        </div>
      )}

      <ProjectGrid projects={allProjets} />
    </div>
  </section>
</BaseLayout>

<style>
  .projets-page {
    min-height: calc(100vh - var(--header-height));
  }

  .page-header {
    text-align: center;
    margin-bottom: var(--space-12);
  }

  .page-title {
    font-size: clamp(2rem, 5vw, 3.5rem);
    margin-bottom: var(--space-4);
  }

  .page-description {
    font-size: var(--text-lg);
    color: var(--text-secondary);
    max-width: 600px;
    margin-left: auto;
    margin-right: auto;
  }

  .error-banner {
    background: rgba(255, 107, 107, 0.1);
    border: 1px solid var(--color-primary);
    border-radius: var(--radius-lg);
    padding: var(--space-4);
    margin-bottom: var(--space-8);
    text-align: center;
  }

  .error-banner p {
    color: var(--color-primary);
    margin: 0;
  }
</style>
